(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n(jQuery)})(function(n){"use strict";var nt=n(window),pt=n(document),i=!0,t=!1,f=null,tt=NaN,p=Infinity,it="undefined",v="directive",l=".cropper",wt=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,bt=/^(x|y|width|height)$/,kt=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio)$/,y="cropper-modal",s="cropper-hidden",w="cropper-invisible",dt="cropper-move",rt="cropper-crop",ut="cropper-disabled",ft="mousedown touchstart",et="mousemove touchmove",ot="mouseup mouseleave touchend touchleave touchcancel",st="wheel mousewheel DOMMouseScroll",ht="resize"+l,ct="dblclick",lt="build"+l,at="built"+l,b="dragstart"+l,k="dragmove"+l,d="dragend"+l,a=function(n){return typeof n=="number"},u=function(i,r){this.element=i;this.$element=n(i);this.defaults=n.extend({},u.DEFAULTS,n.isPlainObject(r)?r:{});this.$original=f;this.ready=t;this.built=t;this.cropped=t;this.rotated=t;this.disabled=t;this.replaced=t;this.init()},r=Math.round,g=Math.sqrt,e=Math.min,h=Math.max,o=Math.abs,vt=Math.sin,yt=Math.cos,c=parseFloat;u.prototype={constructor:u,support:{canvas:n.isFunction(n("<canvas>")[0].getContext)},init:function(){var t=this.defaults;n.each(t,function(n,i){switch(n){case"aspectRatio":t[n]=o(c(i))||tt;break;case"minWidth":case"minHeight":t[n]=o(c(i))||0;break;case"maxWidth":case"maxHeight":t[n]=o(c(i))||p}});this.image={rotate:0};this.load()},load:function(){var e=this,o=this.$element,s=this.element,r=this.image,u,f;if(o.is("img")?f=o.attr("src"):o.is("canvas")&&this.support.canvas&&(f=s.toDataURL()),f){this.$clone&&this.$clone.remove();this.replaced&&(this.replaced=t,r.rotate=0);this.$clone=u=n('<img crossOrigin="Anonymous" src="'+f+'">');u.one("load",function(){r.naturalWidth=this.naturalWidth||u.width();r.naturalHeight=this.naturalHeight||u.height();r.aspectRatio=r.naturalWidth/r.naturalHeight;e.url=f;e.ready=i;e.build()});u.addClass(w).prependTo("body")}},build:function(){var r=this.$element,t=this.defaults,e,f;if(this.ready){this.built&&this.unbuild();r.one(lt,t.build);if(e=n.Event(lt),r.trigger(e),!e.isDefaultPrevented()){this.$cropper=f=n(u.TEMPLATE);r.addClass(s);this.$clone.removeClass(w).prependTo(f);this.rotated||(this.$original=this.$clone.clone(),this.originalImage=n.extend({},this.image));this.$container=r.parent();this.$container.append(f);this.$canvas=f.find(".cropper-canvas");this.$dragger=f.find(".cropper-dragger");this.$viewer=f.find(".cropper-viewer");t.autoCrop?this.cropped=i:this.$dragger.addClass(s);t.dragCrop&&this.setDragMode("crop");t.modal&&this.$canvas.addClass(y);t.dashed||this.$dragger.find(".cropper-dashed").addClass(s);t.movable||this.$dragger.find(".cropper-face").addClass(s);t.resizable||this.$dragger.find(".cropper-line, .cropper-point").addClass(s);this.$scope=t.multiple?this.$cropper:pt;this.addListeners();this.initPreview();this.built=i;this.update();r.one(at,t.built);r.trigger(at)}}},unbuild:function(){this.built&&(this.built=t,this.removeListeners(),this.$preview.empty(),this.$preview=f,this.$dragger=f,this.$canvas=f,this.$container=f,this.$cropper.remove(),this.$cropper=f)},update:function(n){this.initContainer();this.initCropper();this.initImage();this.initDragger();n?(this.setData(n,i),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing);this.resizing=setTimeout(n.proxy(this.update,this,this.getData()),200)},preview:function(){var t=this.image,i=this.dragger,u=t.width,f=t.height,e=i.left-t.left,o=i.top-t.top;this.$viewer.find("img").css({width:r(u),height:r(f),marginLeft:-r(e),marginTop:-r(o)});this.$preview.each(function(){var s=n(this),t=s.width()/i.width;s.find("img").css({width:r(u*t),height:r(f*t),marginLeft:-r(e*t),marginTop:-r(o*t)})})},addListeners:function(){var t=this.defaults;this.$element.on(b,t.dragstart).on(k,t.dragmove).on(d,t.dragend);this.$cropper.on(ft,this._dragstart=n.proxy(this.dragstart,this)).on(ct,this._dblclick=n.proxy(this.dblclick,this));t.zoomable&&this.$cropper.on(st,this._wheel=n.proxy(this.wheel,this));this.$scope.on(et,this._dragmove=n.proxy(this.dragmove,this)).on(ot,this._dragend=n.proxy(this.dragend,this));nt.on(ht,this._resize=n.proxy(this.resize,this))},removeListeners:function(){var n=this.defaults;this.$element.off(b,n.dragstart).off(k,n.dragmove).off(d,n.dragend);this.$cropper.off(ft,this._dragstart).off(ct,this._dblclick);n.zoomable&&this.$cropper.off(st,this._wheel);this.$scope.off(et,this._dragmove).off(ot,this._dragend);nt.off(ht,this._resize)},initPreview:function(){var t='<img src="'+this.url+'">';this.$preview=n(this.defaults.preview);this.$preview.html(t);this.$viewer.html(t)},initContainer:function(){var n=this.$container;this.container={width:n.width(),height:n.height()}},initCropper:function(){var t=this.container,i=this.image,n;i.naturalWidth*t.height/i.naturalHeight-t.width>=0?(n={width:t.width,height:t.width/i.aspectRatio,left:0},n.top=(t.height-n.height)/2):(n={width:t.height*i.aspectRatio,height:t.height,top:0},n.left=(t.width-n.width)/2);this.$cropper.css({width:r(n.width),height:r(n.height),left:r(n.left),top:r(n.top)});this.cropper=n},initImage:function(){var t=this.image,i=this.cropper,r={_width:i.width,_height:i.height,width:i.width,height:i.height,left:0,top:0,ratio:i.width/t.naturalWidth};this.defaultImage=n.extend({},t,r);t._width!==i.width||t._height!==i.height?n.extend(t,r):t=n.extend(r,t);this.image=t;this.renderImage()},renderImage:function(n){var t=this.image;n==="zoom"&&(t.left-=(t.width-t.oldWidth)/2,t.top-=(t.height-t.oldHeight)/2);t.left=e(h(t.left,t._width-t.width),0);t.top=e(h(t.top,t._height-t.height),0);this.$clone.css({width:r(t.width),height:r(t.height),marginLeft:r(t.left),marginTop:r(t.top)});n&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var r=this.defaults,i=this.cropper,u=r.aspectRatio||this.image.aspectRatio,f=this.image.ratio,t;t=i.height*u-i.width>=0?{height:i.width/u,width:i.width,left:0,top:(i.height-i.width/u)/2,maxWidth:i.width,maxHeight:i.width/u}:{height:i.height,width:i.height*u,left:(i.width-i.height*u)/2,top:0,maxWidth:i.height*u,maxHeight:i.height};t.minWidth=0;t.minHeight=0;r.aspectRatio?(isFinite(r.maxWidth)?(t.maxWidth=e(t.maxWidth,r.maxWidth*f),t.maxHeight=t.maxWidth/u):isFinite(r.maxHeight)&&(t.maxHeight=e(t.maxHeight,r.maxHeight*f),t.maxWidth=t.maxHeight*u),r.minWidth>0?(t.minWidth=h(0,r.minWidth*f),t.minHeight=t.minWidth/u):r.minHeight>0&&(t.minHeight=h(0,r.minHeight*f),t.minWidth=t.minHeight*u)):(t.maxWidth=e(t.maxWidth,r.maxWidth*f),t.maxHeight=e(t.maxHeight,r.maxHeight*f),t.minWidth=h(0,r.minWidth*f),t.minHeight=h(0,r.minHeight*f));t.minWidth=e(t.maxWidth,t.minWidth);t.minHeight=e(t.maxHeight,t.minHeight);t.height*=.8;t.width*=.8;t.left=(i.width-t.width)/2;t.top=(i.height-t.height)/2;t.oldLeft=t.left;t.oldTop=t.top;this.defaultDragger=t;this.dragger=n.extend({},t)},renderDragger:function(){var n=this.dragger,t=this.cropper;n.width>n.maxWidth?(n.width=n.maxWidth,n.left=n.oldLeft):n.width<n.minWidth&&(n.width=n.minWidth,n.left=n.oldLeft);n.height>n.maxHeight?(n.height=n.maxHeight,n.top=n.oldTop):n.height<n.minHeight&&(n.height=n.minHeight,n.top=n.oldTop);n.left=e(h(n.left,0),t.width-n.width);n.top=e(h(n.top,0),t.height-n.height);n.oldLeft=n.left;n.oldTop=n.top;this.dragger=n;this.defaults.done(this.getData());this.$dragger.css({width:r(n.width),height:r(n.height),left:r(n.left),top:r(n.top)});this.preview()},reset:function(t){this.cropped&&(t&&(this.defaults.data={}),this.image=n.extend({},this.defaultImage),this.renderImage(),this.dragger=n.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&(this.cropped=t,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(y),this.$dragger.addClass(s))},destroy:function(){var n=this.$element;this.ready&&(this.unbuild(),n.removeClass(s).removeData("cropper"),this.rotated&&n.replaceWith(this.$original))},replace:function(r,u){var s=this,e=this.$element,f=this.element,o;if(r&&r!==this.url)if(u||(this.rotated=t,this.replaced=i),e.is("img"))e.attr("src",r),this.load();else if(e.is("canvas")&&this.support.canvas){o=f.getContext("2d");n('<img src="'+r+'">').one("load",function(){f.width=this.width;f.height=this.height;o.clearRect(0,0,f.width,f.height);o.drawImage(this,0,0);s.load()})}},setData:function(t,i){var o=this.cropper,r=this.dragger,u=this.image,e=this.defaults.aspectRatio;this.built&&typeof t!==it&&((t===f||n.isEmptyObject(t))&&(r=n.extend({},this.defaultDragger)),n.isPlainObject(t)&&!n.isEmptyObject(t)&&(i||(this.defaults.data=t),t=this.transformData(t),a(t.x)&&t.x<=o.width-u.left&&(r.left=t.x+u.left),a(t.y)&&t.y<=o.height-u.top&&(r.top=t.y+u.top),e?a(t.width)&&t.width<=r.maxWidth&&t.width>=r.minWidth?(r.width=t.width,r.height=r.width/e):a(t.height)&&t.height<=r.maxHeight&&t.height>=r.minHeight&&(r.height=t.height,r.width=r.height*e):(a(t.width)&&t.width<=r.maxWidth&&t.width>=r.minWidth&&(r.width=t.width),a(t.height)&&t.height<=r.maxHeight&&t.height>=r.minHeight&&(r.height=t.height))),this.dragger=r,this.renderDragger())},getData:function(){var n=this.dragger,r=this.image,t={};return this.built&&(t={x:n.left-r.left,y:n.top-r.top,width:n.width,height:n.height},t=this.transformData(t,i)),t},transformData:function(t,i){var u=this.image.ratio,f={};return n.each(t,function(n,t){t=c(t);bt.test(n)&&!isNaN(t)&&(f[n]=i?r(t/u):t*u)}),f},setAspectRatio:function(n){var t=n==="auto";n=c(n);(t||!isNaN(n)&&n>0)&&(this.defaults.aspectRatio=t?tt:n,this.built&&(this.initDragger(),this.renderDragger()))},getImageData:function(){var t={};return this.ready&&n.each(this.image,function(n,i){kt.test(n)&&(t[n]=i)}),t},getDataURL:function(t,i){var u=n("<canvas>")[0],r=this.getData(),f="";return this.cropped&&this.support.canvas&&(u.width=r.width,u.height=r.height,u.getContext("2d").drawImage(this.$clone[0],r.x,r.y,r.width,r.height,0,0,r.width,r.height),f=u.toDataURL(t,i)),f},setDragMode:function(n){var r=this.$canvas,u=this.defaults,f=t,e=t;if(this.built&&!this.disabled){switch(n){case"crop":u.dragCrop&&(f=i,r.data(v,n));break;case"move":u.movable&&(e=i,r.data(v,n));break;default:r.removeData(v)}r.toggleClass(rt,f).toggleClass(dt,e)}},enable:function(){this.built&&(this.disabled=t,this.$cropper.removeClass(ut))},disable:function(){this.built&&(this.disabled=i,this.$cropper.addClass(ut))},rotate:function(n){var t=this.image;(n=c(n)||0,this.built&&n!==0&&!this.disabled&&this.defaults.rotatable&&this.support.canvas)&&(this.rotated=i,n=t.rotate=(t.rotate+n)%360,this.replace(this.getRotatedDataURL(n),!0))},getRotatedDataURL:function(t){var h=this.$original.clone(),r=n("<canvas>")[0],i=r.getContext("2d"),v=t*Math.PI/180,s=o(t)%180,y=s>90?180-s:s,u=y*Math.PI/180,c=this.originalImage,f=c.naturalWidth,e=c.naturalHeight,l=o(f*yt(u)+e*vt(u)),a=o(f*vt(u)+e*yt(u));return r.width=l,r.height=a,i.save(),i.translate(l/2,a/2),i.rotate(v),h.addClass(w).prependTo(this.$cropper),i.drawImage(h[0],-f/2,-e/2,f,e),i.restore(),r.toDataURL()},zoom:function(n){var t=this.image,i,u,r;(n=c(n),this.built&&n&&!this.disabled&&this.defaults.zoomable)&&((i=t.width*(1+n),u=t.height*(1+n),r=i/t._width,r>10)||(r<1&&(i=t._width,u=t._height),r<=1?this.setDragMode("crop"):this.setDragMode("move"),t.oldWidth=t.width,t.oldHeight=t.height,t.width=i,t.height=u,t.ratio=t.width/t.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||(this.$canvas.hasClass(rt)?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(n){var i=n.originalEvent,r=117.25,u=5,t;this.disabled||(n.preventDefault(),i.deltaY?(t=i.deltaY,t=t%u==0?t/u:t%r==0?t/r:t/166.66665649414063):t=i.wheelDelta?-i.wheelDelta/120:i.detail?i.detail/3:0,this.zoom(t*.1))},dragstart:function(r){var e=r.originalEvent.touches,u=r,f,o,s;if(!this.disabled){if(e){if(s=e.length,s>1)if(this.defaults.zoomable&&s===2)u=e[1],this.startX2=u.pageX,this.startY2=u.pageY,f="zoom";else return;u=e[0]}if(f=f||n(u.target).data(v),wt.test(f)){if(r.preventDefault(),o=n.Event(b),this.$element.trigger(o),o.isDefaultPrevented())return;this.directive=f;this.cropping=t;this.startX=u.pageX;this.startY=u.pageY;f==="crop"&&(this.cropping=i,this.$canvas.addClass(y))}}},dragmove:function(t){var r=t.originalEvent.touches,i=t,u,f;if(!this.disabled){if(r){if(f=r.length,f>1)if(this.defaults.zoomable&&f===2)i=r[1],this.endX2=i.pageX,this.endY2=i.pageY;else return;i=r[0]}if(this.directive){if(t.preventDefault(),u=n.Event(k),this.$element.trigger(u),u.isDefaultPrevented())return;this.endX=i.pageX;this.endY=i.pageY;this.dragging()}}},dragend:function(i){var r;if(!this.disabled&&this.directive){if(i.preventDefault(),r=n.Event(d),this.$element.trigger(r),r.isDefaultPrevented())return;this.cropping&&(this.cropping=t,this.$canvas.toggleClass(y,this.cropped&&this.defaults.modal));this.directive=""}},dragging:function(){var c=this.directive,b=this.image,d=this.cropper,p=d.width,v=d.height,a=this.dragger,r=a.width,u=a.height,h=a.left,f=a.top,w=h+r,y=f+u,l=i,nt=this.defaults,e=nt.aspectRatio,n={x:this.endX-this.startX,y:this.endY-this.startY},k;e&&(n.X=n.y*e,n.Y=n.x/e);switch(c){case"all":h+=n.x;f+=n.y;break;case"e":if(n.x>=0&&(w>=p||e&&(f<=0||y>=v))){l=t;break}r+=n.x;e&&(u=r/e,f-=n.Y/2);r<0&&(c="w",r=0);break;case"n":if(n.y<=0&&(f<=0||e&&(h<=0||w>=p))){l=t;break}u-=n.y;f+=n.y;e&&(r=u*e,h+=n.X/2);u<0&&(c="s",u=0);break;case"w":if(n.x<=0&&(h<=0||e&&(f<=0||y>=v))){l=t;break}r-=n.x;h+=n.x;e&&(u=r/e,f+=n.Y/2);r<0&&(c="e",r=0);break;case"s":if(n.y>=0&&(y>=v||e&&(h<=0||w>=p))){l=t;break}u+=n.y;e&&(r=u*e,h-=n.X/2);u<0&&(c="n",u=0);break;case"ne":if(e){if(n.y<=0&&(f<=0||w>=p)){l=t;break}u-=n.y;f+=n.y;r=u*e}else n.x>=0?w<p?r+=n.x:n.y<=0&&f<=0&&(l=t):r+=n.x,n.y<=0?f>0&&(u-=n.y,f+=n.y):(u-=n.y,f+=n.y);u<0&&(c="sw",u=0,r=0);break;case"nw":if(e){if(n.y<=0&&(f<=0||h<=0)){l=t;break}u-=n.y;f+=n.y;r=u*e;h+=n.X}else n.x<=0?h>0?(r-=n.x,h+=n.x):n.y<=0&&f<=0&&(l=t):(r-=n.x,h+=n.x),n.y<=0?f>0&&(u-=n.y,f+=n.y):(u-=n.y,f+=n.y);u<0&&(c="se",u=0,r=0);break;case"sw":if(e){if(n.x<=0&&(h<=0||y>=v)){l=t;break}r-=n.x;h+=n.x;u=r/e}else n.x<=0?h>0?(r-=n.x,h+=n.x):n.y>=0&&y>=v&&(l=t):(r-=n.x,h+=n.x),n.y>=0?y<v&&(u+=n.y):u+=n.y;r<0&&(c="ne",u=0,r=0);break;case"se":if(e){if(n.x>=0&&(w>=p||y>=v)){l=t;break}r+=n.x;u=r/e}else n.x>=0?w<p?r+=n.x:n.y>=0&&y>=v&&(l=t):r+=n.x,n.y>=0?y<v&&(u+=n.y):u+=n.y;r<0&&(c="nw",u=0,r=0);break;case"move":b.left+=n.x;b.top+=n.y;this.renderImage("move");l=t;break;case"zoom":nt.zoomable&&(this.zoom(function(n,t,i,r,u,f){return(g(u*u+f*f)-g(i*i+r*r))/g(n*n+t*t)}(b.width,b.height,o(this.startX-this.startX2),o(this.startY-this.startY2),o(this.endX-this.endX2),o(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2);break;case"crop":n.x&&n.y&&(k=this.$cropper.offset(),h=this.startX-k.left,f=this.startY-k.top,r=a.minWidth,u=a.minHeight,n.x>0?n.y>0?c="se":(c="ne",f-=u):n.y>0?(c="sw",h-=r):(c="nw",h-=r,f-=u),this.cropped||(this.cropped=i,this.$dragger.removeClass(s)))}l&&(a.width=r,a.height=u,a.left=h,a.top=f,this.directive=c,this.renderDragger());this.startX=this.endX;this.startY=this.endY}};u.TEMPLATE=function(n,t){return t=t.split(","),n.replace(/\d+/g,function(n){return t[n]})}('<0 6="5-container"><0 6="5-canvas"><\/0><0 6="5-dragger"><1 6="5-viewer"><\/1><1 6="5-8 8-h"><\/1><1 6="5-8 8-v"><\/1><1 6="5-face" 3-2="all"><\/1><1 6="5-7 7-e" 3-2="e"><\/1><1 6="5-7 7-n" 3-2="n"><\/1><1 6="5-7 7-w" 3-2="w"><\/1><1 6="5-7 7-s" 3-2="s"><\/1><1 6="5-4 4-e" 3-2="e"><\/1><1 6="5-4 4-n" 3-2="n"><\/1><1 6="5-4 4-w" 3-2="w"><\/1><1 6="5-4 4-s" 3-2="s"><\/1><1 6="5-4 4-ne" 3-2="ne"><\/1><1 6="5-4 4-nw" 3-2="nw"><\/1><1 6="5-4 4-sw" 3-2="sw"><\/1><1 6="5-4 4-se" 3-2="se"><\/1><\/0><\/0>',"div,span,directive,data,point,cropper,class,line,dashed");u.DEFAULTS={aspectRatio:"auto",data:{},done:n.noop,preview:"",multiple:t,autoCrop:i,dragCrop:i,dashed:i,modal:i,movable:i,resizable:i,zoomable:i,rotatable:i,minWidth:0,minHeight:0,maxWidth:p,maxHeight:p,build:f,built:f,dragstart:f,dragmove:f,dragend:f};u.setDefaults=function(t){n.extend(u.DEFAULTS,t)};u.other=n.fn.cropper;n.fn.cropper=function(t){var r=[].slice.call(arguments,1),i;return this.each(function(){var e=n(this),f=e.data("cropper"),o;f||e.data("cropper",f=new u(this,t));typeof t=="string"&&n.isFunction(o=f[t])&&(i=o.apply(f,r))}),typeof i!==it?i:this};n.fn.cropper.Constructor=u;n.fn.cropper.setDefaults=u.setDefaults;n.fn.cropper.noConflict=function(){return n.fn.cropper=u.other,this}});
//# sourceMappingURL=cropper.min.js.map
